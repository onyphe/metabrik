#!/usr/bin/perl
#
# $Id$
#
use strict;
use warnings;

BEGIN {
   use File::HomeDir;

   my $lib = File::HomeDir->my_home."/perl5/lib/perl5";
   $lib =~ s/\\/\//g; # Converts Windows paths

   eval("use lib \"$lib\";");
   if ($@) {
      chomp($@);
      die("[F] meby: unable to load Metabricky libs [$@]\n");
   }
}

use Metabricky::Brick::Core::Context;

my $script = shift;

my $context = Metabricky::Brick::Core::Context->new;
$context->init or return;

if (defined($script)) {
   $context->load('shell::meby') or return;
   $context->run('shell::meby', 'script', $script);
}
else {
   $context->load('shell::rc') or return;
   $context->load('shell::meby') or return;

   # ASCII art courtesy: http://patorjk.com/software/taag/#p=testall&f=Graffiti&t=Metabricky
   print<<EOF

 ███▄ ▄███▓▓█████▄▄▄█████▓ ▄▄▄       ▄▄▄▄    ██▀███  ██▓ ▄████▄  ██ ▄█▀▓██   ██▓
▓██▒▀█▀ ██▒▓█   ▀▓  ██▒ ▓▒▒████▄    ▓█████▄ ▓██ ▒ ██▓██▒▒██▀ ▀█  ██▄█▒  ▒██  ██▒
▓██    ▓██░▒███  ▒ ▓██░ ▒░▒██  ▀█▄  ▒██▒ ▄██▓██ ░▄█ ▒██▒▒▓█     ▓███▄░   ▒██ ██░
▒██    ▒██ ▒▓█  ▄░ ▓██▓ ░ ░██▄▄▄▄██ ▒██░█▀  ▒██▀▀█▄ ░██░▒▓▓▄ ▄█▒▓██ █▄   ░ ▐██▓░
▒██▒   ░██▒░▒████▒ ▒██▒ ░  ▓█   ▓██▒░▓█  ▀█▓░██▓ ▒██░██░▒ ▓███▀░▒██▒ █▄  ░ ██▒▓░
░ ▒░   ░  ░░░ ▒░ ░ ▒ ░░    ▒▒   ▓▒█░░▒▓███▀▒░ ▒▓ ░▒▓░▓  ░ ░▒ ▒ ░▒ ▒▒ ▓▒   ██▒▒▒ 
░  ░      ░ ░ ░  ░   ░      ▒   ▒▒ ░▒░▒   ░   ░▒ ░ ▒ ▒ ░  ░  ▒  ░ ░▒ ▒░ ▓██ ░▒░ 
░      ░      ░    ░        ░   ▒    ░    ░   ░░   ░ ▒ ░░       ░ ░░ ░  ▒ ▒ ░░  
       ░      ░  ░              ░  ░ ░         ░     ░  ░ ░     ░  ░    ░ ░     
                                          ░             ░               ░ ░     

EOF
;

   my $version = $context->run('core::global', 'metabricky_version');

   print "--[ Welcome to Metabricky - Knowledge is in your head, Detail is in the code ]--\n";
   print "--[ Version $version ]--\n";
   print "\n";

   print "    There is a Brick for that.\n\n";

   $context->run('shell::meby', 'cmdloop');
}
